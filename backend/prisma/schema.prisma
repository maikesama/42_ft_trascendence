// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
	provider = "prisma-client-js"
}

datasource db {
	provider = "postgresql"
	url      = env("DATABASE_URL")
}

model User {
	id              Int             @id @unique @default(autoincrement())
	idIntra         String          @unique
	userName        String          @unique
	email           String          @default("")
	tel             String          @default("")
	img             String
	firstName       String
	lastName        String
	isVerified      Boolean         @default(false)
	twoFa           Boolean         @default(false)
	otpSecret       String          @default("")
	otpUrl          String          @default("")  
	win             Int             @default(0)
	loss            Int             @default(0)
	rank            Int             @default(0)
	friends         Friends[]       @relation(name: "friends")
	blocked         Blocklist[]     @relation(name: "block")
	blockedby       Blocklist[]     @relation(name: "blocked")
	chat						Chat[]
	admin						Admin[]
	participant			Participant[] 
}

model Friends {
	friendId  String @unique
	Friends   User  @relation(name: "friends", fields: [friendId], references: [idIntra])
}

model Blocklist {
	blockId   String
	blockedId String

	block     User    @relation(name: "block", fields: [blockId], references: [idIntra])
	blocked     User    @relation(name: "blocked", fields: [blockedId], references: [idIntra])

	@@id([blockId, blockedId])
}

model Games {
	idGame                Int             @id @default(autoincrement())
	user1                 String          
	user2                 String          
	scoreP1               Int             @default(0) 
	scoreP2               Int             @default(0)       
}

model Admin{
	idIntra String
	idChat	Int
	user		User	@relation(fields: [idIntra], references: [idIntra])
	chat		Chat	@relation(fields: [idChat], references: [id])
	@@id([idIntra, idChat])
}

model Participant{
	idIntra String
	idChat	Int
	user		User			@relation(fields: [idIntra], references: [idIntra])
	chat		Chat			@relation(fields: [idChat], references: [id])
	muted		Boolean		@default(false)
	@@id([idIntra, idChat])
}

model Chat {
	id					Int			@unique @default(autoincrement())
	name				String
	users				User		@relation(fields: [idIntra], references: [idIntra])
	idIntra			String
	type				String	@default("public")
	password		String?
	admin				Admin[]
	participant	Participant[]
	banned			String[]
	@@id([name, idIntra])
}

